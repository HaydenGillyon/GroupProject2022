<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Lobby</title>
</head>
<body>
    <textarea id="log" cols="100" rows="20"></textarea><br>
    <input id="ready" type="button" value="Ready">
    {{ lobby_code|json_script:"lobby-code" }}
    {{ username|json_script:"username" }}
    <script>
        const code = JSON.parse(document.getElementById('lobby-code').textContent);
        const username = JSON.parse(document.getElementById('username').textContent);

        // Establishes the websocket connection
        const lobbySocket = new WebSocket(
            'ws://'
            + window.location.host
            + '/ws/game/'
            + code
            + '/'
        );

        // When the websocket receives a message
        lobbySocket.onmessage = function(e) {
            const data = JSON.parse(e.data);
            // Displays the message on screen
            document.querySelector('#log').value += (data.message + '\n')
        }

        // Send a message to the socket when the player is ready
        document.querySelector('#ready').onclick = function(e) {
            ready = "ready"
            lobbySocket.send(JSON.stringify({
                'ready':ready,
                'username':username,
            }));
        };
    </script>
</body>
</html>
